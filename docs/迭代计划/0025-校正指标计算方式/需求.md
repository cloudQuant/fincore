### 背景
docs/0025-校正指标计算方式/指标算法帮助文档.docx  这个文档里面是一些第三方平台的指标的计算方式

### 任务
1. 希望你能从这个指标算法帮助文档.docx里面提取出这些指标的计算方式
2. 从当前项目中获取相应指标的计算方式
3. 对比现在项目中的指标的计算方式和指标算法帮助文档里面的计算方式有什么区别
4. 如果有区别，把有区别的指标，以及差异的地方放到这个文档的下面。

---

## 对比结果

### 全局差异

| 项目 | 文档（第三方平台） | fincore |
|------|-------------------|---------|
| **日频年化因子 q** | 250 | 252 (`APPROX_BDAYS_PER_YEAR`) |
| **周/月/季频年化因子** | 52 / 12 / 4 | 52 / 12 / 4（一致） |
| **年化收益计算** | CAGR: `∏(1+ri)^(q/T) - 1` | CAGR: `cum_returns_final^(1/num_years) - 1`，其中 `num_years = T / ann_factor`，数学上等价 |

> **影响范围**：日频年化因子 250 vs 252 会影响所有涉及年化的指标。无风险利率默认值 3% vs 0 会影响夏普、索提诺、卡玛、特雷诺等所有使用 rf 的指标。

---

### 有差异的指标详情


#### 20. R 平方

- **文档**：`R² = (β × σ_B / σ_P)²`（CAPM 回归拟合优度）
- **fincore**：无直接对应函数
  - `r_cubed` (`stats.py:444`) 计算的是 correlation³（不同指标）
  - `stability_of_timeseries` (`ratios.py:817`) 计算的是累积对数收益的线性拟合 R²
- **差异**：**fincore 缺少文档定义的 CAPM R² 指标**

---

### fincore 缺少的指标

以下指标在文档中有定义，但 fincore 中没有直接对应的实现：

| 文档指标 | 说明 |
|---------|------|
| **投资胜率（相对沪深300）** | fincore 有 `win_rate`（绝对胜率），但没有相对基准的胜率 |
| **MAR 比率** | 文档用算术平均年化收益/最大回撤，fincore 的 `calmar_ratio` 用 CAGR/最大回撤 |
| **回归年度回报率 RAR** | 净值对时间线性回归的斜率，fincore 未实现 |
| **R 立方（海龟指标）** | RAR / 平均最大年回撤幅度，fincore 的 `r_cubed` 是不同定义 |
| **R 平方（CAPM）** | (β × σ_B / σ_P)²，fincore 未实现此定义 |
| **上行/下行捕获收益** | fincore 仅有捕获率，没有单独的捕获收益指标 |
| **VaR 超额收益**（文档定义） | 文档为年化收益/VaR，fincore 的 `var_excess_return` 是尾部平均收益 |

---

### 差异汇总优先级

| 优先级 | 差异 | 影响面 |
|--------|------|--------|

| **高** | 夏普比率分子：CAGR vs 算术年化 | 夏普比率、信息比率 |
| **高** | 下行风险计算方式完全不同 | 索提诺比率 |
| **高** | VaR/CVaR 缺少年化/持有期调整 | VaR、CVaR、条件夏普比率 |
| **中** | 调整夏普比率定义完全不同 | 调整夏普比率 |
| **中** | 残差风险自由度 T-2 vs T-1 | 残差风险 |
| **中** | 捕获率上行条件 >= 0 vs > 0 | 上行捕获率 |
| **中** | STUTZER 指数缺少符号和 sqrt(2) 缩放 | STUTZER 指数 |
| **低** | 卡玛比率是否减 rf | 卡玛比率 |
| **低** | Kappa3/Omega 阈值处理细节 | Kappa3、Omega |
| **低** | 择时模型原始收益 vs 超额收益 | C-L、H-M、T-M 模型 |