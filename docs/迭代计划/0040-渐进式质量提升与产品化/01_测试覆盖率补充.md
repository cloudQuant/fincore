# Phase 1: 测试覆盖率 100%

## 当前状态

根据 git status，项目已有针对覆盖缺失的测试文件：
- `tests/test_coverage_gaps.py`
- `tests/test_metrics/test_remaining_missing_coverage.py`
- `tests/test_metrics/test_stats_missing_coverage.py`
- `tests/test_risk/test_evt_remaining_coverage.py`
- `tests/test_empyrical/test_treynor_coverage.py`

说明团队已经在推进覆盖率提升工作。

## 剩余工作

### 1. stats.py 模块

**目标函数**: `hurst_exponent`, `r_cubed_turtle`

**需覆盖边界条件**:
- 极短序列（n < 5）
- 常数序列（std=0）
- 空 Series
- 非 DatetimeIndex

### 2. alpha_beta.py 模块

**目标函数**: `annual_alpha`, `annual_beta`

**需覆盖边界条件**:
- 空输入
- 非重叠日期范围
- 非 DatetimeIndex

### 3. ratios.py 模块

**目标函数**: `calmar_ratio`, `mar_ratio`

**需覆盖边界条件**:
- 全 NaN 输入
- 零回撤

### 4. risk/evt.py 模块

**目标函数**: `gpd_fit`, `evt_cvar`

**需覆盖边界条件**:
- 指数分布情况（xi ≈ 0）
- 未知模型类型

### 5. round_trips.py 模块

**目标函数**: `gen_round_trip_stats`

**需覆盖边界条件**:
- 带 symbol 列
- 无内置函数路径

## 执行步骤

```bash
# 1. 运行覆盖率报告
pytest tests --cov=fincore --cov-report=term-missing:skip-covered -q | tail -50

# 2. 找出覆盖率 < 100% 的模块
# 3. 为每个模块补充边界条件测试
# 4. 重新运行覆盖率报告验证
```

## 测试模板

```python
class Test{ModuleName}EdgeCases:
    """Edge case tests for {module_name}."""

    def test_empty_input(self):
        """Test with empty input."""
        # TODO
        pass

    def test_nan_input(self):
        """Test with all NaN values."""
        # TODO
        pass

    def test_single_value(self):
        """Test with single value."""
        # TODO
        pass
```

## 验收标准

- 整体覆盖率 >= 99%
- 核心模块 (metrics/, core/) 覆盖率 = 100%
