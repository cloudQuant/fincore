# 蒙特卡洛模拟 API

`fincore.simulation` 提供蒙特卡洛路径模拟和 Bootstrap 统计推断工具。

## 模块导入

```python
from fincore.simulation import MonteCarlo, bootstrap, bootstrap_ci
```

## `MonteCarlo`

蒙特卡洛路径模拟器，基于历史收益率参数生成未来路径。

### `MonteCarlo.simulate(returns, n_paths=1000, horizon=252, starting_value=1.0)`

**参数**:

| 参数 | 类型 | 说明 |
|------|------|------|
| `returns` | `pd.Series` | 历史收益率序列 |
| `n_paths` | `int` | 模拟路径数（默认 1000） |
| `horizon` | `int` | 模拟步数/天数（默认 252） |
| `starting_value` | `float` | 起始净值（默认 1.0） |

**返回**: `MonteCarlo` 实例

### MonteCarlo 属性

| 属性 | 类型 | 说明 |
|------|------|------|
| `n_paths` | int | 路径数 |
| `horizon` | int | 模拟步数 |
| `terminal_values` | np.ndarray | 终端净值数组 |
| `paths` | np.ndarray | 完整路径矩阵 (n_paths × horizon) |

### MonteCarlo 方法

| 方法 | 返回 | 说明 |
|------|------|------|
| `var(alpha=0.05)` | float | 模拟 VaR |
| `cvar(alpha=0.05)` | float | 模拟 CVaR / Expected Shortfall |

```python
mc = MonteCarlo.simulate(returns, n_paths=10000, horizon=252)
print(f"Median terminal: {np.median(mc.terminal_values):.4f}")
print(f"VaR(95%): {mc.var(alpha=0.05):.4f}")
print(f"CVaR(95%): {mc.cvar(alpha=0.05):.4f}")
```

## `bootstrap(returns, func, n_samples=10000)`

对任意统计量进行 Bootstrap 重采样，返回统计量的分布。

**参数**:

| 参数 | 类型 | 说明 |
|------|------|------|
| `returns` | `pd.Series` | 收益率序列 |
| `func` | `callable` | 统计函数，接受 pd.Series 返回标量 |
| `n_samples` | `int` | 重采样次数（默认 10000） |

**返回**: `np.ndarray` — 统计量的 Bootstrap 分布

```python
from fincore import Empyrical

dist = bootstrap(returns, func=Empyrical.sharpe_ratio, n_samples=5000)
print(f"Bootstrap mean: {dist.mean():.4f}")
print(f"Bootstrap std:  {dist.std():.4f}")
```

## `bootstrap_ci(returns, func, n_samples=10000, alpha=0.05)`

计算 Bootstrap 置信区间。

**参数**:

| 参数 | 类型 | 说明 |
|------|------|------|
| `returns` | `pd.Series` | 收益率序列 |
| `func` | `callable` | 统计函数 |
| `n_samples` | `int` | 重采样次数 |
| `alpha` | `float` | 显著性水平（默认 0.05 → 95% CI） |

**返回**: `tuple[float, float]` — (下界, 上界)

```python
ci = bootstrap_ci(returns, func=Empyrical.sharpe_ratio, n_samples=10000, alpha=0.05)
print(f"95% CI: [{ci[0]:.4f}, {ci[1]:.4f}]")
```

## 使用示例

```python
from fincore.simulation import MonteCarlo, bootstrap_ci
from fincore import Empyrical

# 1. 蒙特卡洛模拟
mc = MonteCarlo.simulate(returns, n_paths=10000, horizon=252)
print(f"1年后净值中位数: {np.median(mc.terminal_values):.4f}")
print(f"亏损概率: {(mc.terminal_values < 1.0).mean():.2%}")

# 2. Bootstrap 夏普比率的置信区间
ci = bootstrap_ci(returns, func=Empyrical.sharpe_ratio, n_samples=10000)
print(f"夏普比率 95% CI: [{ci[0]:.4f}, {ci[1]:.4f}]")

# 3. Bootstrap 最大回撤的置信区间
ci_dd = bootstrap_ci(returns, func=Empyrical.max_drawdown, n_samples=10000)
print(f"最大回撤 95% CI: [{ci_dd[0]:.4f}, {ci_dd[1]:.4f}]")
```
