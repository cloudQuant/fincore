# 绩效归因 API

`fincore.attribution` 提供多种绩效归因方法，用于分解投资组合的超额收益来源。

## 模块导入

```python
from fincore.attribution import (
    brinson_attribution, brinson_results,
    FamaFrenchModel,
    style_analysis, StyleResult,
    calculate_style_tilts, calculate_regression_attribution,
    analyze_performance_by_style,
)
```

## Brinson 归因

将主动收益分解为**配置效应**（资产配置贡献）和**选择效应**（个股选择贡献）。

### `brinson_attribution(portfolio_weights, benchmark_weights, portfolio_returns, benchmark_returns)`

**参数**:

| 参数 | 类型 | 说明 |
|------|------|------|
| `portfolio_weights` | `pd.Series` | 组合各行业/资产权重 |
| `benchmark_weights` | `pd.Series` | 基准各行业/资产权重 |
| `portfolio_returns` | `pd.Series` | 组合各行业/资产收益 |
| `benchmark_returns` | `pd.Series` | 基准各行业/资产收益 |

**返回**: `dict`

```python
{
    "allocation": float,   # 配置效应
    "selection": float,    # 选择效应
    "interaction": float,  # 交互效应
    "total_active": float, # 总主动收益
}
```

### `brinson_results(...)`

参数与 `brinson_attribution` 相同，返回 `pd.DataFrame`，包含每个行业/资产的详细分解。

## Fama-French 多因子模型

### `FamaFrenchModel`

基于 Fama-French 因子的收益归因模型。

```python
from fincore.attribution import FamaFrenchModel

model = FamaFrenchModel(returns, factor_data)
print(model.alpha)
print(model.betas)
print(model.r_squared)
```

## 风格分析

### `style_analysis(returns, factors)`

基于约束回归的收益风格分析（Sharpe 风格分析），将组合收益分解为因子暴露。

**参数**:

| 参数 | 类型 | 说明 |
|------|------|------|
| `returns` | `pd.Series` | 组合收益率 |
| `factors` | `pd.DataFrame` | 因子收益率，每列一个因子 |

**返回**: `StyleResult`

### `calculate_style_tilts(returns, factors)`

计算风格倾斜度。

**返回**: 风格倾斜分析结果

### `calculate_regression_attribution(returns, factors)`

基于无约束回归的因子归因。

**返回**: `dict`

```python
{
    "alpha": float,        # 超额收益（截距）
    "betas": dict,         # 因子暴露 {factor_name: beta}
    "r_squared": float,    # 解释力 R²
    "residual": pd.Series, # 残差序列
}
```

### `analyze_performance_by_style(returns, factors)`

综合风格绩效分析。

## 使用示例

```python
from fincore.attribution import brinson_attribution, style_analysis, calculate_regression_attribution

# 1. Brinson 归因
result = brinson_attribution(
    portfolio_weights=port_w,
    benchmark_weights=bench_w,
    portfolio_returns=port_r,
    benchmark_returns=bench_r,
)
print(f"配置效应: {result['allocation']:.4f}")
print(f"选择效应: {result['selection']:.4f}")

# 2. 风格分析
style = style_analysis(returns, factor_df)

# 3. 回归归因
reg = calculate_regression_attribution(returns, factor_df)
print(f"Alpha: {reg['alpha']:.6f}")
print(f"R²:    {reg['r_squared']:.4f}")
```
