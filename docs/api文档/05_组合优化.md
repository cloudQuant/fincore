# 组合优化 API

`fincore.optimization` 提供组合优化工具，包括有效前沿、风险平价和约束优化。

## 模块导入

```python
from fincore.optimization import efficient_frontier, risk_parity, optimize
```

## `efficient_frontier(returns, n_points=50, risk_free=0)`

计算均值-方差有效前沿。

**参数**:

| 参数 | 类型 | 说明 |
|------|------|------|
| `returns` | `pd.DataFrame` | 多资产收益率，每列一个资产 |
| `n_points` | `int` | 前沿上的点数（默认 50） |
| `risk_free` | `float` | 无风险利率（默认 0） |

**返回**: `pd.DataFrame`，包含 `return`, `risk`, `weights` 等列

```python
ef = efficient_frontier(returns_df, n_points=30)
print(ef[["return", "risk"]].head())
```

## `risk_parity(returns)`

风险平价组合——使每个资产对组合风险的贡献相等。

**参数**:

| 参数 | 类型 | 说明 |
|------|------|------|
| `returns` | `pd.DataFrame` | 多资产收益率 |

**返回**: `np.ndarray` — 权重向量，和为 1

```python
weights = risk_parity(returns_df)
print(dict(zip(returns_df.columns, weights)))
```

## `optimize(returns, objective="max_sharpe", **kwargs)`

约束优化，支持多种目标函数。

**参数**:

| 参数 | 类型 | 说明 |
|------|------|------|
| `returns` | `pd.DataFrame` | 多资产收益率 |
| `objective` | `str` | 优化目标（见下表） |
| `target` | `float` | 目标收益率（当 objective="target_return" 时） |
| `risk_free` | `float` | 无风险利率（默认 0） |

**支持的 objective 值**:

| 值 | 说明 |
|---|------|
| `"max_sharpe"` | 最大化夏普比率 |
| `"min_variance"` | 最小化组合方差 |
| `"target_return"` | 给定目标收益下最小化风险 |

**返回**: `dict`

```python
{
    "weights": np.ndarray,  # 最优权重
    "return": float,        # 预期年化收益
    "risk": float,          # 预期年化波动率
    "sharpe": float,        # 夏普比率
}
```

## 使用示例

```python
from fincore.optimization import efficient_frontier, risk_parity, optimize

# 有效前沿
ef = efficient_frontier(returns_df, n_points=50)

# 风险平价
rp = risk_parity(returns_df)

# 最大夏普
ms = optimize(returns_df, objective="max_sharpe")
print(f"Max Sharpe weights: {ms['weights']}")
print(f"Sharpe: {ms['sharpe']:.4f}")

# 最小方差
mv = optimize(returns_df, objective="min_variance")

# 目标收益
tr = optimize(returns_df, objective="target_return", target=0.10)
```
