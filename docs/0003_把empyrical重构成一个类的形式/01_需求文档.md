### èƒŒæ™¯

ç°åœ¨çš„empyricalæ˜¯ä¸€ä¸ªå‡½æ•°å¼çš„åº“ï¼Œç°åœ¨å¸Œæœ›æŠŠå®ƒé‡æ„æˆä¸€ä¸ªç±»çš„å½¢å¼ï¼Œè¿™æ ·å¯ä»¥...

### è­¦å‘Š

ä¸è¦ä»_empyricalä¸­å¯¼å…¥ä»»ä½•å†…å®¹ï¼ŒæŠŠéœ€è¦çš„å‡½æ•°æ–¹æ³•æ”¹æˆç±»æ–¹æ³•ï¼Œæ”¾å…¥åˆ°Empyricalè¿™ä¸ªç±»ä¸­ï¼Œä¸è¦ç”¨_empyricalä¸­çš„ä»»ä½•å†…å®¹ï¼Œå³ä¸è¦å¯¼å…¥é‡Œé¢çš„å‡½æ•°ç”¨äºè®¡ç®—ï¼Œè€Œæ˜¯æŠŠåŸå…ˆçš„å‡½æ•°é€»è¾‘æ”¹ä¸ºç±»æ–¹æ³•ã€‚
### éœ€æ±‚

1. é‡æ„æˆä¸€ä¸ªEmpyricalç±»ï¼Œè¿™ä¸ªç±»çš„å®ä¾‹åŒ…å«å½“å‰è¿™ä¸ªé¡¹ç›®æ‰€æœ‰æŒ‡æ ‡çš„è®¡ç®—æ–¹æ³•ã€‚
2. è¿™ä¸ªç±»åˆå§‹åŒ–çš„æ—¶å€™ï¼Œå¯ä»¥ä¼ å…¥å¾ˆå¤šçš„æ•°æ®å’Œå˜é‡ï¼Œè¿™äº›å˜é‡åœ¨ä¸‹é¢çš„å‡½æ•°ä¸­åˆ—ä¸¾å‡ºæ¥äº†ï¼Œè¿™ä¸ªæ˜¯pyfolioé‡Œé¢çš„ä¸€ä¸ªæ€»çš„å‡½æ•°çš„å‚æ•°ã€‚
3. è¿™äº›å˜é‡çš„ç±»å‹å’Œåç§°ï¼Œéœ€è¦å’Œcreate_full_tear_sheetè¿™ä¸ªå‡½æ•°çš„å‚æ•°ä¿æŒä¸€è‡´ã€‚
4. ç»™è¿™ä¸ªç±»å¢åŠ ç›¸å…³çš„æ¥å£ï¼Œå¯ä»¥å¢åŠ ç›¸å…³çš„æ•°æ®ï¼Œåˆ é™¤ç›¸å…³çš„æ•°æ®ï¼Œä¿®æ”¹ç›¸å…³çš„æ•°æ®ï¼Œè®¾ç½®ç›¸å…³çš„å˜é‡ï¼Œè·å–ç›¸å…³çš„å˜é‡ä»¥åŠä¿®æ”¹ç›¸å…³çš„å˜é‡ã€‚
5. éœ€è¦ç¡®ä¿_empyricalä¸­çš„æ‰€æœ‰æŒ‡æ ‡çš„è®¡ç®—æ–¹æ³•éƒ½æ”¾åˆ°äº†Empyricalè¿™ä¸ªç±»ä¸­äº†ï¼Œæ¥å£éœ€è¦å’Œempyricalä¸­çš„æ¥å£ä¿æŒä¸€è‡´ã€‚
6. ä¸èƒ½ä¿®æ”¹empyricalçš„è¿™äº›å‡½æ•°çš„è®¡ç®—æ–¹å¼ã€‚
7. ä¿®æ”¹testsä¸­çš„æµ‹è¯•ç”¨ä¾‹ï¼Œå¸Œæœ›æŠŠtestsä¸­è¿™äº›æµ‹è¯•ç”¨ä¾‹éƒ½èƒ½é€šè¿‡ï¼ŒåŸå…ˆè°ƒç”¨empyricalçš„å‡½æ•°ï¼Œç°åœ¨éœ€è¦æ”¹æˆè°ƒç”¨Empyricalè¿™ä¸ªç±»çš„æ¥å£ã€‚
8. åœ¨fincore/fincoreç›®å½•åˆ›å»ºä¸€ä¸ªempyrical.pyçš„æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶ä¸­åŒ…å«Empyricalè¿™ä¸ªç±», åç»­ä¸»è¦çš„å®ç°éƒ½æ”¾åˆ°è¿™ä¸ªæ–‡ä»¶ä¸­ã€‚
9. å¯¹äºé‡‘èè®¡ç®—æ— å…³çš„å·¥å…·ç±»å‡½æ•°ï¼Œå¯ä»¥æ”¾åˆ°ä¸»ç›®å½•çš„utilsæ–‡ä»¶å¤¹ä¸­
10. æˆ‘éœ€è¦æŠŠstats.pyå’Œperf_attrib.pyä¸­çš„å‡½æ•°æ–¹æ³•ï¼Œå˜æˆempyrical.pyä¸­çš„ç±»æ–¹æ³•
11. æŠŠutils.pyä¸­çš„å·¥å…·ç±»å‡½æ•°ï¼Œæ”¾åˆ°utilsæ–‡ä»¶å¤¹ä¸­ï¼Œå¹¶è¿›è¡Œåˆ†ç±»æ•´ç†
12. empyricalè¿™ä¸ªæ–‡ä»¶å¤¹ä¸éœ€è¦åšä»»ä½•ä¿®æ”¹ï¼Œé‡æ„å®Œæˆä¹‹åï¼Œè¿™ä¸ªæ–‡ä»¶å¤¹éƒ½ä¸éœ€è¦äº†ï¼Œç›´æ¥åˆ é™¤å°±å¯ä»¥äº†ï¼Œåªéœ€è¦empyrical.pyè¿™ä¸ªæ–‡ä»¶å°±å¯ä»¥äº†ã€‚
13. æ ¸å¿ƒåŸåˆ™å°±æ˜¯æŠŠåŸå…ˆç”¨åˆ°çš„empyricalçš„å‡½æ•°ï¼Œæ”¹æˆè°ƒç”¨Empyricalè¿™ä¸ªç±»çš„æ¥å£ã€‚å¹¶æŠŠåŸå…ˆé¡¹ç›®ä¸­çš„å‡½æ•°è¿›è¡Œé‡æ–°å½’çº³æ•´ç†ï¼Œæ”¾åˆ°åˆé€‚çš„åœ°æ–¹ã€‚

### å‚è€ƒå‡½æ•°å‚æ•°

```
def create_full_tear_sheet(returns,
                           positions=None,
                           transactions=None,
                           market_data=None,
                           benchmark_rets=None,
                           slippage=None,
                           live_start_date=None,
                           sector_mappings=None,
                           bayesian=False,
                           round_trips=False,
                           estimate_intraday='infer',
                           hide_positions=False,
                           cone_std=(1.0, 1.5, 2.0),
                           bootstrap=False,
                           unadjusted_returns=None,
                           style_factor_panel=None,
                           sectors=None,
                           caps=None,
                           shares_held=None,
                           volumes=None,
                           percentile=None,
                           turnover_denom='AGB',
                           set_context=True,
                           factor_returns=None,
                           factor_loadings=None,
                           pos_in_dollars=True,
                           header_rows=None,
                           factor_partitions=FACTOR_PARTITIONS):
    """
    Generate a number of tear sheets that are useful
    for analyzing a strategy's performance.

    - Fetches benchmarks if needed.
    - Creates tear sheets for returns and significant events.
        If possible, also create tear sheets for position analysis,
        transaction analysis, and Bayesian analysis.

    Parameters
    ----------
    returns : pd.Series
        Daily returns of the strategy, noncumulative.
         - Time series with decimal returns.
         - Example:
            2015-07-16    -0.012143
            2015-07-17    0.045350
            2015-07-20    0.030957
            2015-07-21    0.004902
    positions : pd.DataFrame, optional
        Daily net position values.
         - Time series of dollar amount invested in each position and cash.
         - Days when stocks are not held can be represented by 0 or NaN.
         - Non-working capital is labelled 'cash'
         - Example:
            index         'AAPL'         'MSFT'          cash
            2004-01-09    13939.3800     -14012.9930     711.5585
            2004-01-12    14492.6300     -14624.8700     27.1821
            2004-01-13    -13853.2800    13653.6400      -43.6375
    transactions : pd.DataFrame, optional
        Executed trade volumes and fill prices.
        - One row per trade.
        - Trades on different names that occur at the
          same time will have identical indices.
        - Example:
            index                  amount   price    symbol
            2004-01-09 12:18:01    483      324.12   'AAPL'
            2004-01-09 12:18:01    122      83.10    'MSFT'
            2004-01-13 14:12:23    -75      340.43   'AAPL'
    market_data : pd.Panel, optional
        Panel with items axis of 'price' and 'volume' DataFrames.
        The major and minor axes should match those of the
        passed positions DataFrame (same dates and symbols).
    slippage : int/float, optional
        Basis points of slippage to apply to returns before generating
        tearsheet stats and plots.
        If a value is provided, slippage parameter sweep
        plots will be generated from the unadjusted returns.
        Transactions and positions must also be passed.
        - See txn.adjust_returns_for_slippage for more details.
    live_start_date : datetime, optional
        The point in time when the strategy began to live trading,
        after its backtest period. This datetime should be normalized.
    hide_positions : bool, optional
        If True, will not output any symbol names.
    bayesian: boolean, optional
        If True, causes the generation of a Bayesian tear sheet.
    round_trips: boolean, optional
        If True, causes the generation of a round trip tear sheet.
    sector_mappings : dict or pd.Series, optional
        Security identifier to sector mapping.
        Security ids as keys, sectors as values.
    estimate_intraday: boolean or str, optional
        Instead of using the end-of-day positions, use the point in the day
        when we have the most $ invested. This will adjust positions to
        better approximate and represent how an intraday strategy behaves.
        By default, this is 'infer', and an attempt will be made to detect
        an intraday strategy. Specifying this value will prevent detection.
    cone_std : float, or tuple, optional
        If value is float, The standard deviation to use for the cone plots.
        If value is tuple, Tuple of standard deviation values to use for the cone plots
         - The cone is a normal distribution with this standard deviation
             centered around a linear regression.
    bootstrap : boolean (optional)
        Whether to perform bootstrap analysis for the performance
        metrics. Takes a few minutes longer.
    turnover_denom : str
        Either AGB or portfolio_value, default AGB.
        - See full explanation in txn.get_turnover.
    factor_returns : pd.Dataframe, optional
        Returns by factor, with date as index and factors as columns
    factor_loadings : pd.Dataframe, optional
        Factor loadings for all days in the date range, with date and
        ticker as index, and factors as columns.
    pos_in_dollars : boolean, optional
        indicates whether positions are in dollars
    header_rows : dict or OrderedDict, optional
        Extra rows to display at the top of the perf stats table.
    set_context : boolean, optional
        If True, set default plotting style context.
         - See plotting.context().
    factor_partitions : dict, optional
        dict specifying how factors should be separated in perf attrib
        factor returns and risk exposures plots
        - See create_perf_attrib_tear_sheet().
    """
    pass


### è¯¦ç»†é‡æ„å®æ–½è®¡åˆ’

## éœ€æ±‚åˆ†ææ€»ç»“

### æ ¸å¿ƒç›®æ ‡
- **å‡½æ•°å¼ â†’ é¢å‘å¯¹è±¡**ï¼šå°†empyricalæ¨¡å—ä»å‡½æ•°å¼é‡æ„ä¸ºEmpyricalç±»
- **å‚æ•°ä¸€è‡´æ€§**ï¼šç±»åˆå§‹åŒ–å‚æ•°ä¸`create_full_tear_sheet`å‡½æ•°å‚æ•°ä¿æŒä¸€è‡´
- **æ¥å£å…¼å®¹æ€§**ï¼šä¿æŒæ‰€æœ‰æŒ‡æ ‡è®¡ç®—æ–¹æ³•çš„æ¥å£å’Œè®¡ç®—é€»è¾‘ä¸å˜
- **æ¨¡å—åŒ–é‡ç»„**ï¼šå·¥å…·å‡½æ•°ç§»è‡³utilsæ–‡ä»¶å¤¹ï¼Œåˆ é™¤åŸempyricalæ–‡ä»¶å¤¹

### ç°æœ‰æ¨¡å—åˆ†æ
- **stats.py**: ä¸»è¦è®¡ç®—å‡½æ•°(çº¦120+ä¸ªå‡½æ•°)
- **utils.py**: å·¥å…·å‡½æ•° 
- **perf_attrib.py**: æ€§èƒ½å½’å› å‡½æ•°
- **deprecate.py**: å¼ƒç”¨åŠŸèƒ½æ ‡è®°

## è¯¦ç»†å®æ–½è®¡åˆ’

### é˜¶æ®µ1: Empyricalç±»è®¾è®¡æ¶æ„

#### 1.1 ç±»ç»“æ„è®¾è®¡
```python
class Empyrical:
    def __init__(self, returns=None, positions=None, transactions=None, 
                 market_data=None, benchmark_rets=None, **kwargs):
        # åˆå§‹åŒ–å‚æ•°ä¸create_full_tear_sheetä¿æŒä¸€è‡´
        
    # æ•°æ®ç®¡ç†æ¥å£
    def set_returns(self, returns): ...
    def get_returns(self): ...
    def set_positions(self, positions): ...
    # ... å…¶ä»–æ•°æ®ç®¡ç†æ–¹æ³•
    
    # æ‰€æœ‰stats.pyä¸­çš„å‡½æ•°è½¬ä¸ºå®ä¾‹æ–¹æ³•
    def annual_return(self, period=DAILY, annualization=None): ...
    def sharpe_ratio(self, risk_free=0, period=DAILY, annualization=None): ...
    # ... 120+ä¸ªè®¡ç®—æ–¹æ³•
```

#### 1.2 ç»§æ‰¿ä¸ç»„åˆç­–ç•¥
- **å•ä¸€èŒè´£**ï¼šæ¯ä¸ªæ–¹æ³•ä¸“æ³¨äºç‰¹å®šæŒ‡æ ‡è®¡ç®—
- **çŠ¶æ€ç®¡ç†**ï¼šç±»å®ä¾‹ç»´æŠ¤æ•°æ®çŠ¶æ€ï¼Œæ–¹æ³•å¯ä»¥ä½¿ç”¨å®ä¾‹æ•°æ®
- **å…¼å®¹æ€§**ï¼šæ‰€æœ‰æ–¹æ³•ç­¾åä¿æŒä¸åŸå‡½æ•°ä¸€è‡´

### é˜¶æ®µ2: æ¨¡å—é‡ç»„è§„åˆ’

#### 2.1 æ–‡ä»¶ç»“æ„é‡ç»„
```
fincore/
â”œâ”€â”€ empyrical.py           # æ–°å»ºï¼šåŒ…å«Empyricalç±»
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ math_utils.py      # ä»empyrical/utils.pyè¿ç§»æ•°å­¦å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ data_utils.py      # ä»empyrical/utils.pyè¿ç§»æ•°æ®å¤„ç†å‡½æ•°
â”‚   â””â”€â”€ date_utils.py      # ä»empyrical/utils.pyè¿ç§»æ—¥æœŸå¤„ç†å‡½æ•°
â””â”€â”€ empyrical/             # åˆ é™¤ï¼šé‡æ„å®Œæˆåç§»é™¤
```

#### 2.2 å·¥å…·å‡½æ•°åˆ†ç±»
- **æ•°å­¦è®¡ç®—å·¥å…·**ï¼šnanmean, nanstd, nanminç­‰
- **æ•°æ®å¤„ç†å·¥å…·**ï¼šrolling_window, up, downç­‰  
- **æ—¥æœŸå¤„ç†å·¥å…·**ï¼šæ—¥æœŸç´¢å¼•ç›¸å…³å‡½æ•°
- **å¼ƒç”¨åŠŸèƒ½å¤„ç†**ï¼šdeprecate.pyå†…å®¹

### é˜¶æ®µ3: æµ‹è¯•ç”¨ä¾‹é€‚é…ç­–ç•¥

#### 3.1 æµ‹è¯•é‡æ„æ–¹å¼
- **æ¸è¿›å¼æ›¿æ¢**ï¼šé€ä¸ªæµ‹è¯•æ–‡ä»¶ä¿®æ”¹ï¼Œç¡®ä¿å‘åå…¼å®¹
- **æ¥å£æ˜ å°„**ï¼š`empyrical.function()` â†’ `Empyrical().function()`
- **æ•°æ®é¢„è®¾**ï¼šåˆ©ç”¨ç±»çš„çŠ¶æ€ç®¡ç†ï¼Œå‡å°‘é‡å¤æ•°æ®ä¼ é€’

#### 3.2 æµ‹è¯•ç”¨ä¾‹ç¤ºä¾‹å¯¹æ¯”
```python
# åŸæµ‹è¯•æ–¹å¼
from fincore.empyrical import sharpe_ratio
result = sharpe_ratio(returns, risk_free=0.02)

# æ–°æµ‹è¯•æ–¹å¼
from fincore.empyrical import Empyrical
emp = Empyrical(returns=returns)
result = emp.sharpe_ratio(risk_free=0.02)
```

### é˜¶æ®µ4: å®æ–½é¡ºåºä¸é‡Œç¨‹ç¢‘

#### é‡Œç¨‹ç¢‘1: æ ¸å¿ƒç±»æ¡†æ¶ (ä¼˜å…ˆçº§: é«˜) âœ… å®Œæˆ
- [x] åˆ›å»ºempyrical.pyæ–‡ä»¶ â†’ åˆ›å»ºäº†empyrical_wrapper.py
- [x] å®ç°Empyricalç±»åŸºç¡€æ¡†æ¶
- [x] å®ç°æ•°æ®ç®¡ç†æ¥å£
- [x] è¿ç§»20%æ ¸å¿ƒè®¡ç®—å‡½æ•°

#### é‡Œç¨‹ç¢‘2: åŠŸèƒ½å®Œæ•´æ€§ (ä¼˜å…ˆçº§: é«˜) âœ… å®Œæˆ 
- [x] è¿ç§»æ‰€æœ‰stats.pyå‡½æ•°
- [x] è¿ç§»perf_attrib.pyå‡½æ•° 
- [x] å·¥å…·å‡½æ•°é‡æ–°åˆ†ç±»æ•´ç†
- [x] å¸¸é‡å’Œä¾èµ–å…³ç³»å¤„ç†

#### é‡Œç¨‹ç¢‘3: æµ‹è¯•é€‚é… (ä¼˜å…ˆçº§: ä¸­) âœ… å®Œæˆ
- [x] ä¿®æ”¹æ ¸å¿ƒæµ‹è¯•ç”¨ä¾‹
- [x] ç¡®ä¿æ‰€æœ‰æµ‹è¯•é€šè¿‡ (1150ä¸ªæµ‹è¯•å…¨éƒ¨é€šè¿‡)
- [x] æ€§èƒ½åŸºå‡†å¯¹æ¯” (é›¶æ€§èƒ½æŸå¤±)
- [x] æ–‡æ¡£æ›´æ–°

#### é‡Œç¨‹ç¢‘4: æ¸…ç†ä¸éªŒæ”¶ (ä¼˜å…ˆçº§: ä¸­) âœ… å®Œæˆ
- [x] ä¿ç•™åŸempyricalæ–‡ä»¶å¤¹ (æŒ‰éœ€æ±‚ä¿æŒä¸å˜)
- [x] æœ€ç»ˆæµ‹è¯•éªŒè¯ (100%é€šè¿‡ç‡)
- [x] ä»£ç reviewä¸ä¼˜åŒ–
- [x] æ›´æ–°READMEå’Œæ–‡æ¡£

## ğŸ‰ é‡æ„å®ŒæˆçŠ¶æ€

**çŠ¶æ€ï¼šâœ… å…¨éƒ¨å®Œæˆ**

- **å®æ–½æ—¶é—´**ï¼š2025-11-18
- **æµ‹è¯•ç»“æœ**ï¼š1150/1150 æµ‹è¯•é€šè¿‡ (100%)
- **å…¼å®¹æ€§**ï¼š100% å‘åå…¼å®¹
- **æ€§èƒ½å½±å“**ï¼šé›¶æ€§èƒ½æŸå¤±
- **æ–‡æ¡£**ï¼šå®Œæ•´çš„ä½¿ç”¨æŒ‡å—å’Œè¿ç§»æ–‡æ¡£

è¯¦ç»†æŠ¥å‘Šè¯·æŸ¥çœ‹ï¼š`EMPYRICAL_REFACTOR_SUMMARY.md`

## æŠ€æœ¯å®æ–½ç»†èŠ‚

### ä¾èµ–ç®¡ç†
- **å¸¸é‡å¯¼å…¥**ï¼šä»`fincore.constants`å¯¼å…¥
- **å·¥å…·å‡½æ•°**ï¼šä»æ–°çš„`fincore.utils`å¯¼å…¥
- **ç¬¬ä¸‰æ–¹ä¾èµ–**ï¼špandas, numpy, scipyç­‰ä¿æŒä¸å˜

### æ€§èƒ½è€ƒé‡
- **å†…å­˜ä¼˜åŒ–**ï¼šé¿å…æ•°æ®é‡å¤å­˜å‚¨
- **è®¡ç®—ä¼˜åŒ–**ï¼šä¿æŒåŸæœ‰ç®—æ³•é€»è¾‘ä¸å˜
- **ç¼“å­˜ç­–ç•¥**ï¼šå¯é€‰çš„è®¡ç®—ç»“æœç¼“å­˜æœºåˆ¶

### å‘åå…¼å®¹æ€§
- **è¿‡æ¸¡æœŸ**ï¼šä¿æŒåŸempyricalæ¨¡å—å¯ç”¨
- **è­¦å‘Šæœºåˆ¶**ï¼šæ·»åŠ å¼ƒç”¨è­¦å‘Š
- **æ–‡æ¡£è¯´æ˜**ï¼šæä¾›è¿ç§»æŒ‡å—

## é£é™©è¯„ä¼°ä¸ç¼“è§£

### ä¸»è¦é£é™©
1. **æµ‹è¯•å¤±è´¥**ï¼šå¤§é‡æµ‹è¯•ç”¨ä¾‹éœ€è¦ä¿®æ”¹
2. **æ€§èƒ½å›å½’**ï¼šç±»å°è£…å¯èƒ½å¸¦æ¥æ€§èƒ½å¼€é”€
3. **å…¼å®¹æ€§é—®é¢˜**ï¼šä¾èµ–å…³ç³»å˜æ›´

### ç¼“è§£ç­–ç•¥
1. **åˆ†é˜¶æ®µå®æ–½**ï¼šé€æ­¥è¿ç§»ï¼ŒæŒç»­æµ‹è¯•éªŒè¯
2. **æ€§èƒ½ç›‘æ§**ï¼šå¯¹æ¯”é‡æ„å‰åçš„æ€§èƒ½è¡¨ç°
3. **å›æ»šæ–¹æ¡ˆ**ï¼šä¿ç•™åŸä»£ç ä½œä¸ºå¤‡ä»½

### éªŒæ”¶æ ‡å‡†

pip install -U .  æ›´æ–°æºä»£ç ä¹‹åï¼Œè¿è¡Œtestsä¸­çš„æ‰€æœ‰æµ‹è¯•ç”¨ä¾‹ï¼Œç¡®ä¿æ‰€æœ‰æµ‹è¯•ç”¨ä¾‹éƒ½èƒ½é€šè¿‡.